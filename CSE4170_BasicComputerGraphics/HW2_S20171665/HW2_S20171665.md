# 기초 컴퓨터 그래픽스 Assigment 2



## 1. 환경 명세



### 작업 환경

Windows 11 64bit, i7-1185G7 3GHz, Intel Iris Xe Graphics(내장그래픽), Visual Studio 2022 Debug x64



### 테스트 환경

다양한 기기에서 테스트를 수행하고자 Macbook Pro(2021, M1 Pro)의 Parallels 18 Virtual Machine으로 Windows 11 가상환경에서 실행했지만, OpenGL context version을 4.0에서 3.3으로 낮춰야 하는 문제가 있어서 기존 방식대로 version을 4.0을 유지하고 가상화 없이 Windows 11에서 실행하는 전제로 작업했습니다.





## 2. 요구사항



> ***케이크 괴물의 도시 침공***
>
> ![스크린샷 2023-04-16 031503](과제/스크린샷 2023-04-16 031503.png)
>
> 거대 케이크 괴물이 도시를 침공했습니다. 여러분은 도시를 구해야 합니다. 그래서 자동차로 도로를 운전하여 케이크 괴물로 달려가는 중입니다. 하지만 케이크 괴물도 이를 가만히 보고만 있지 않습니다. 케이크가 비행기를 폭탄처럼 발사하며 도로에 있는 차에 공격을 시도합니다. 케이크의 비행기 공격과 도시를 탈출하려는 자동차를 잘 피해서 주행하세요. 부디 행운을 빕니다. :)





### 기본적인 게임 조작



1. `←`, `→` 방향키로 적색 자동차를 좌우로 움직일 수 있습니다.
2. 적색 자동차는 현재 도로 앞으로 주행 중입니다.
3. 왼쪽 상단에 적색 자동차의 분홍색 HP 게이지가 있습니다. HP 게이지가 모두 차감되면 게임은 종료됩니다.
4. 주행 반대 방향으로 다가오는 파란색 차를 좌우 방향키를 움직여서 잘 피하세요. 충돌 범위 안에 들어올 경우 충돌 데미지를 입습니다.
5. 케이크가 비행기를 발사하여 도로에 투하합니다. 도로에 떨어진 비행기는 폭발하면서 주변에 피해를 입힙니다.

* 난이도를 높게 해서 즐기고 싶으면 윈도우의 너비를 줄여보세요. 반대로 너비를 늘리면 쉬운 난이도로 즐길 수 있습니다. 이 게임은 윈도우의 크기가 난이도 외의 플레이 요소에 큰 영향을 주지 않습니다.





### (a) 



> 다음 왼쪽 그림의 9개의 물체 중 5개를 선택한 후, 각 물체에 대하여 서로 다른 창의적인 동적 효과를 생성할 것. 



#### 사용한 물체: 비행기



##### 부여한 창의적인 동적 효과



차도 위로 주기마다 임의의 위치에 직선으로 비행기가 떨어지고, 그 위치는 폭발에 의해 공격을 당합니다. 비행기가 투하된 위치 주변으로 파란색 차가 가까이 있으면 차가 비행기 공격에 의해 도로 밖으로 빙글빙글 구르면서 날라갑니다. 마찬가지로 운전 중인 적색 차가 비행기에 의해 공격 받으면 그 자리에서 빙글빙글 회전합니다. 자동차가 왼쪽 도로에 위치하면 공격 받은 차는 반시계 방향으로 회전하고, 반대로 오른쪽 도로에 위치하면 시계 방향으로 회전합니다. 파란색 차는 비행기에 의해 공격 받으면 도로 밖으로 날라가지만, 적색 차는 제자리에서 회전하면서 분홍색 HP 게이지가 차감됩니다. 비행기의 투하 위치는 랜덤 시드에 의해 결정됩니다.



##### 확인 방법



비행기가 도로 위에 직선으로 떨어집니다. 비행기가 도로에 닿으면 섬광을 일으키면서 폭발합니다. 자동차를 주행하면 자연스럽게 비행기의 공격을 목격할 수 있습니다. 비행기의 공격에 의해 피해를 입으면 HP 게이지의 차감을 당하니 조심하세요.





#### 사용한 물체: 자동차



##### 부여한 창의적인 동적 효과



여러분은 적색 자동차를 타고 도로를 달립니다. 자동차가 주행 중이라는 느낌을 주기 위해 차의 흔들림에 의한 translation으로 진동 효과를 주었습니다. 적색 자동차는 좌우 방향키로 조작 가능합니다. 적색 차가 비행기 공격을 받으면 제자리에서 회전하며 HP가 차감됩니다.

도로 위로 도시를 탈출하려는 파란색 차들이 적색 차가 주행 중인 방향의 반대로 다가옵니다. 파란색 차와 적색 차가 충돌하면 파란색 차는 빙글빙글 회전하며 도로 밖으로 날라가고, 적색차는 비행기 공격 데미지처럼 제자리에서 회전하며 HP가 차감됩니다. 파란색 차도 비행기의 공격에 영향을 받을 수 있는데, 공격에 의해 빙글빙글 회전하며 적색 차와의 충돌 때처럼 도로 밖으로 날라갑니다. 파란색 차가 도로를 주행하면서 진동하는 모습을 현실적으로 그리기 위해 shearing을 구현하여 매 시간마다 흔들리는 세부적인 요소를 목격할 수 있습니다. 또한 적색 자동차보다 파란색 차가 앞에 있으면 파란색 자동차가 적색 자동차를 일부 가리는 효과도 구현했습니다.





##### 확인 방법



적색 자동차를 방향키를 움직여 가면서 파란색 차와 충돌하면 어떻게 되는지 직접 충돌하면 그 효과를 확인할 수 있습니다. 그리고 파란색 자동차는 비행기에 의해 임의의 시간에 공격 받으면 도로 밖으로 날라갑니다. 주행하면서 자연스럽게 확인 가능합니다.





#### 사용한 물체: 케이크



##### 부여한 창의적인 동적 효과



케이크는 일정 주기마다 수축하고 팽창하면서 비행기와 옷을 공중으로 무작위로 날리면서 공격을 수행합니다. 케이크에 의해 발사된 비행기와 옷은 포물선을 그리면서 하늘로 날라갑니다. 랜덤 시드에 의해 공격 위치와 포물선 궤도가 정해진다는 점이 특이할 만한 사항입니다.



##### 확인 방법



도로 끝에 보이는 케이크가 주기적으로 어떤 모습을 보이는지 확인할 수 있습니다. 





#### 사용한 물체: 집



##### 부여한 창의적인 동적 효과



적색 자동차로 도로를 주행하면 도로 옆에 있는 집들이 뒤로 지나가는 모습을 구현했습니다.  집이 자동차에 가까이 올수록 집의 크기가 커지는 모습이 인상적입니다. 또한 왼쪽에 있는 집들은 시야에 의해 약간 오른쪽으로 기울어져 있고, 반대로 오른쪽에 있는 집들은 약간 왼쪽으로 기울어져 있습니다. 이는 shearing을 사용했는데, 기본적으로 shearing을 수행할 수 있는 함수가 존재하지 않아서 scaling과 rotation에 의해 shearing을 수행한 것이 주목할 만합니다.



##### 확인 방법



도로 양끝에서 지평선 멀리 작게 보이는 집들이 점점 앞으로 다가오면서 크게 보입니다. 그리고 자세히 보면 왼쪽 도로에 위치하고 있는지 오른쪽 도로에 위치하고 있는지에 따라 집의 기울기가 다르게 보입니다.





#### 사용한 물체: 옷(흰색 와이셔츠)



##### 부여한 창의적인 동적 효과



케이크의 주기적인 공격에 의해 케이크가 포물선 궤도를 그리면서 지평선에서 시작하여 하늘로 날라갑니다. 특이할 만한 사항은 옷이 날라가면서 단추 선을 중심 축으로 하여 공중에서 회전합니다. 2D에서 마치 3D로 회전하는 걸 구현하기 위해 scaling 효과를 $x$축과 $y$축 기준으로 여러 번 수행하여 공중에서 회전하는 듯한 효과를 구현합니다.



##### 확인 방법



케이크가 비행기와 함께 공중으로 옷을 날리는 모습을 목격할 수 있습니다. 옷은 단추 선을 축으로 하여 회전하면서 포물선 궤도를 그리며 하늘을 날라갑니다. 비행기와는 달리 도로에 떨어져서 공격을 수행하지는 않습니다.







### (b) 



> 충분히 복잡도가 있는 2차원 기하 물체를 자신이 한 개 모델링 한 후, 위의 물체들처럼 창의적인 동적 효과를 생성하라.



#### 도로 양 옆으로 달려오는 사람



##### 부여한 창의적인 동적 효과



케이크의 공격에서 탈출하고자 많은 사람들이 도시를 탈출하려고 합니다. 도로 양끝으로 도시를 탈출하려는 사람들의 행렬을 목격할 수 있습니다. 지평선 멀리서 가까이 오면 올수록 크기가 커지면서, 동시에 뛰는 모습을 구현하기 위해 팔과 다리를 빠르게 움직이는 효과를 구현했습니다. 이는 scaling과 shearing으로 다리와 팔의 모습을 매 순간마다 다르게 그리는 방법을 사용했습니다. 사람들은 케이크의 공격에 의해 겁에 질린 얼굴 표정을 짓고 있습니다.



##### 확인 방법



주행 중에 도로의 양 옆으로 달려오는 사람들의 모습을 확인할 수 있습니다. 참고로 주행 중인 적색 차의 운전자의 뒷 모습도 확인할 수 있습니다. 





#### 비행기 공격에 의한 섬광 효과



##### 부여한 창의적인 동적 효과



비행기가 떨어진 자리는 폭발하면서 섬광을 일으킵니다. 이를 위해 빨간색, 주황색, 노란색의 불꽃 도형이 폭발하면서 점점 커지는 효과를 구현했습니다. 비행기가 떨어지는 위치와 떨어졌는지 여부를 계산해서 도형을 그려야 하며, 그 섬광이 생기는 자리에 자동차가 있는지의 여부도 고려해야 하므로 상대적으로 어려운 난이도의 구현이었습니다.



##### 확인 방법



비행기가 도로 위에 떨어질 때 나타나면서 커지는 섬광 효과를 확인해 보세요. 또한 섬광의 일정 범위 안에 자동차가 존재할 경우 도로 밖으로 날라가는 파란색 자동차를 발견하고 주행 중인 적색 자동차가 제자리에서 빙글빙글 도는 경험을 해 보세요.





#### 지평선 위로 보이는 산



##### 부여한 창의적인 동적 효과



적색 자동차가 도로를 주행하면서 저 멀리 지평선에 보이는 산들의 크기가 보이면서 양옆으로 커지는 효과를 구현하여 마치 실제로 도로를 주행하는 현실감을 부여했습니다. 심심한 배경에 조금이나마 재미있는 효과를 주기 위한 노력이었습니다.



##### 확인 방법



차를 운전하면서 지평선 위의 산들이 작게 보이다가 양옆으로 커지는 모습을 확인해 보세요.







### (c)



> 제출한 숙제 중 가장 재미있고 복잡도가 있는 기하 변환 및 애니메이션 효과를 생성한 학생을 적절히 선정하여 최대 25점까지 추가 점수를 부여할 수 있음 (정확한 숫자는 상황에 따라 유동적임). 공정을 기하기 위하여 컴퓨터 그래픽스 연구실 대학원생들이 공동으로 심사함.



#### 추가 점수를 부여 받아야 할 이유



##### 2D에서의 3D view 효과



이 게임은 기본적으로 2D로 구현되었지만 그 안에서 원근감과 자동차 간의 겹침 요소, 3D 회전 효과 등 도로를 바라보는 현실의 사실적인 요소들을 구현하기 위해 여러 시도를 했습니다. 멀리 있는 물체의 모습은 작게 표현하면서 가까이에 다가올수록 물체의 크기를 점점 키우는 효과는 필수적이었습니다. 또한 비행기가 도로에 떨어지는 위치를 계산할 때 가로 위상 뿐만이 아니라 원근을 고려하여 세로 위상까지 같이 고려했습니다. 비행기가 폭발할 때 나타나는 섬광을 확인해 보면 자동차에서 멀리  떨어지는 섬광의 크기는 작게, 가까이 떨어지는 섬광의 크기는 크게 표현했습니다. 이러한 3D 고려 요소는 모든 object에 관해 고려되어야 하므로 전반적인 요소들의 상호작용을 이해하는 게 요구되었습니다.

집, 자동차, 사람의 원근에 따른 occlusion을 구현하기 위해 미리 계산한 model matrix를 priority queue에 넣고, 이 원소들을 $y$ 좌표가 큰 순으로 정렬하여 그림으로써 앞쪽에 위치한 물체가 뒤에 있는 물체에 의해 가려지지 않도록 처리했습니다.





##### 랜덤 시드에 의해 결정되는 요소들



각 물체들에 일일이 의도하여 위치와 크기 정보를 초기화하지 않고 랜덤 시드에 의해 무작위적으로 결정되었습니다. 다만 seed는 $32,223$ 하나로 고정하여 사용했습니다. 게임 제작자의 의도가 반영되기 보다는 기본적인 알고리즘과 파이프라인이 주어진 상태에서 시드에 의해 랜덤으로 물체들이 상호작용하도록 하여 예상치 못한 재미를 부각시키고자 했습니다.





##### Bounding Box 계산



단순히 물체를 그리는 것뿐만이 아니라 그 물체들이 비행기의 공격에 의한 판정 조건과 좌우 방향키를 통해 주행하는 자동차를 움직이는 효과를 추가로 구현해야 했습니다. 이를 위해 각 물체가 어떤 위치에 그려질지를 계산해야 하므로 해당 물체를 감싸는 bounding box도 같이 예측하는 것이 필요로 합니다. 자동차 간의 충돌 판정과 비행기 공격 판정 모두 각 물체의 bounding box를 사용하여 계산했습니다. 또한 자동차 간의 occlusion도 bounding box의 $y$ 좌표를 고려하여 계산했습니다.





##### 세부적인 사항



- 주행 중인 자동차를 제외한 모든 물체는 상대적인 위치로 계산되므로 윈도우 크기를 조정해도 지속하여 즐길 수 있습니다. 예를 들어, 차가 도로 밖으로 벗어나지 않아야 하는데, 윈도우의 크기를 자유롭게 조정해도 차의 위치가 벗어나지 않습니다. 
- 차의 진동 효과와 사람이 걸어가는 모습을 scaling을 통해 좌우 반전을 반복하는 방법으로 구현했습니다.
- 다가오는 차의 흔들림 효과와 도로 양옆의 집들을 그릴 때 shearing을 사용했습니다. 그러나 OpenGL에서 바로 사용할 수 있는 함수가 존재하지 않아 shearing을 scaling과 rotation으로 직접 구현했습니다.
- 사람의 옷, 집의 지붕, 자동차 프레임의 색에 세 가지의 색을 사용하여 시각적인 단조로움을 덜었습니다.

